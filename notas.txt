# ALTERAR WSS ANTES DE DAR MERGE EM MAIN PELO AMOR DE DEUS

# tarefas
- adicionar POST em create chat
- deletar conta
- escrever testes gerais

# observações e dúvidas
- channel layers não funciona no Render pq REDIS_URL é substituído por localhost
- talvez trocar chat_uuid por uuid
- connect e disconnect ao mudar de página, forum diz que só com SPA
- type em resposta ao cliente, send -> onmessage

# conectando com o container do postgres e criando banco
docker run --rm -p 5432:5432 -e POSTGRES_PASSWORD=postgres -v papo-volume:/var/lib/postgresql/data postgres:17
docker exec -it <id> bash
root@<id>:/# psql -U postgres
postgres=# create database papo;
postgres=# \q
postgres=# exit

# comandos
- rodar -- talvez colocar no compose
uv run daphne -b 0.0.0.0 -p 8000 papo.asgi:application
- encerrar processo na porta 8000
fuser -k -n tcp 8000
- iniciar channel layer:
docker run --rm -p 6379:6379 -e TZ=America/Sao_Paulo redis:7
- sort imports
ruff check --select I --fix

# docker
- build docker image
docker build -t papo-image .
- run docker image
docker run -it -p 8000:8000 --name papo papo-image
- builda compose e roda o trem
docker compose up --build
- compose para fazer alterações
docker compose up --watch
- testes no compose
docker exec -it <container-id> python manage.py test
- dirruba tudo da memória e os volumes também
docker compose down -v
- faz migrations, tem que botar no dockerfile ou compose.yml
docker compose run web python manage.py migrate

# referencias
https://leapcell.io/blog/building-real-time-applications-with-django-channels-beyond-simple-websockets

https://developer.mozilla.org/en-US/docs/Learn_web_development/Extensions/Server-side/Django/Testing#locallibrary_tests
https://www.geeksforgeeks.org/python/how-to-authenticate-a-user-in-tests-in-django/
https://stackoverflow.com/questions/63066240/setup-postgres-in-github-actions-for-django
https://stackoverflow.com/questions/37694987/connecting-to-postgresql-in-a-docker-container-from-outside
https://medium.com/@hmbarotov/dockerizing-django-with-uv-postgres-and-redis-e1dd9abe9640
https://medium.com/@jonathan.hoffman91/django-tests-cheatsheet-2025-4fae3d32c3c5
https://github.com/NilCoalescing/djangochannelsrestframework/blob/master/tests/test_consumer.py#L27
https://github.com/andrewgodwin/channels-examples
https://github.com/anshuUnity/whatsapp-clone
https://stackoverflow.com/questions/28513528/passing-arguments-to-model-methods-in-django-templates
https://www.digitalocean.com/community/questions/django-websockets-with-daphne-a-complete-guide
https://www.youtube.com/watch?v=u7siCTdGhuw&list=PL5E1F5cTSTtRSP3Qb8-gZ-Hm5AXp3VKvu
https://django-tutorial.dev/course/django-specifics/custom-user-model/adding-fields/
https://docs.djangoproject.com/en/5.2/topics/auth/customizing/#using-a-custom-user-model-when-starting-a-project
https://cheatography.com/ogr/cheat-sheets/django/

# quote importante da documentação do channels
"Channels are mailboxes that represent users in a group, such as a chat room.
When a user posts a message, a JavaScript function will transmit the message
over WebSocket to a ChatConsumer. The ChatConsumer will receive that message
and forward it to the group corresponding to the room name. Every ChatConsumer
in the same group (and thus in the same room) will then receive the message
from the group and forward it over WebSocket back to JavaScript, where it will
be appended to the chat log."
