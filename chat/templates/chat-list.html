{% load static %}
<div id="chat-list" class="flex flex-col bg-white border-black border-r-2 relative">
    <div class="flex p-3 bg-white sticky top-0 z-10">
        <h2 class="text-2xl font-bold text-black">Conversas</h2>
    </div>
    {% for chat in request.user.chats.all %}
        {% for user in chat.users.all %}
            {% if user != request.user %}
            <a href="{% url 'chat' chat.chat_uuid %}">
                <div id="chat-{{ chat.chat_uuid }}" class="chat-item flex items-center font-medium gap-2 p-2 hover:bg-emerald-300 rounded-lg z-0 overflow-y-auto grow" onmouseover="showDeleteButton('{{ chat.chat_uuid }}')" onmouseout="hideDeleteButton('{{ chat.chat_uuid }}')">
                    <img class="w-10 h-10 rounded-full object-cover" src="{% static 'img/profile-pic.png' %}">
                    {{ user.username }}
                    {% if user.status.online_status %}
                    <span id="ws-{{ user.id }}" class="inline-block w-3 h-3 bg-emerald-400 rounded-full ml-auto"
                        title="Online"></span>
                    {% else %}
                    <span id="ws-{{ user.id }}" class="hidden" title="Offline"></span>
                    {% endif %}
                    <form id="deleteForm-{{ chat.chat_uuid }}" method="POST" action="{% url 'delete-chat' chat.chat_uuid %}" class="hidden ml-auto">
                        {% csrf_token %}
                        <button type="submit" class="w-6 h-6 bg-gray-400 rounded-full hover:bg-red-500 hover:text-white text-center text-sm flex items-center justify-center"
                        onclick="return confirm('Você tem certeza que quer deletar essa conversa? Ela será apagada para ambos usuários!')">
                            <i class="fa-solid fa-trash-can text-xs"></i>
                        </button>
                    </form>
                </div>
            </a>
            {% endif %}
        {% endfor %}
    {% endfor %}
</div>
<script>
    function showDeleteButton(chatId) {
        const deleteForm = document.getElementById('deleteForm-' + chatId);
        if (deleteForm) {
            deleteForm.classList.remove('hidden');
        }
    }
    
    function hideDeleteButton(chatId) {
        const deleteForm = document.getElementById('deleteForm-' + chatId);
        if (deleteForm) {
            deleteForm.classList.add('hidden');
        }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        const chatItems = document.querySelectorAll('.chat-item');
        chatItems.forEach(item => {
            item.addEventListener('mouseover', function() {
                const chatId = this.id.replace('chat-', '');
                showDeleteButton(chatId);
            });
            item.addEventListener('mouseout', function() {
                const chatId = this.id.replace('chat-', '');
                hideDeleteButton(chatId);
            });
        });
    });
</script>